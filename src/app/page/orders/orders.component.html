<!--
<div class="header is-center">
  <p>Orders and items (you can add a new one or make a payment on the order)</p>
</div>
-->
<div class="content">
  <div class="container-fluid">
    <div class="row justify-content-between mb-3">
      <h2>Orders</h2>
      <app-dialog-order-create></app-dialog-order-create>
    </div>
    <div class="row justify-content-md-center mb-3">
      <table class="pure-table pure-table-horizontal">
      <thead>
        <tr>
          <th rowspan="2" class="align-middle text-center">Order No#</th>
          <th rowspan="2" class="align-middle text-center">Date</th>
          <th rowspan="2" class="align-middle text-center">Customer</th>
          <th colspan="2" class="align-middle text-center">Invoices</th>
          <th colspan="8" class="align-middle text-center">Items</th>
        </tr>
        <tr>
          <th class="align-middle text-center">No#</th>
          <th class="align-middle text-center">Date</th>
          <th class="align-middle text-center">Seller</th>
          <th class="align-middle text-center">SKU</th>
          <th class="align-middle text-center">price</th>
          <th class="align-middle text-center">qty</th>
          <th class="align-middle text-center">total shipping</th>
          <th class="align-middle text-center">total price</th>
          <th class="align-middle text-center">total fee</th>
          <th class="align-middle text-center">status</th>
        </tr>
      </thead>
        <tbody>
          <tr *ngFor="let order of model.orders">
            <td class="text-center align-middle">
              <span>{{order.id}}</span>
              <div class="btn-group-vertical btn-group-sm" role="group">
                <button class="btn btn-sm btn-primary"
                        *ngIf="order.isNoPaid"
                        (click)="model.toPay(order, 'RP')"
                        type="button">pay RP</button>
                <button class="btn btn-sm  btn-primary"
                        *ngIf="order.isNoPaid"
                        (click)="model.toPay(order, 'PT')"
                        type="button">pay PT</button>
                <button class="btn btn-sm btn-success"
                        *ngIf="order.canInvoice"
                        (click)="model.toInvoiceOrder(order)"
                        type="button">invoice</button>
                <button class="btn btn-sm btn-danger"
                        *ngIf="order.canRefund"
                        (click)="model.toRefundOrder(order)"
                        type="button">refund</button>
              </div>
            </td>
            <td>{{order.createdAt | date : 'yy/M/d h:mm:ss'}}</td>
            <td>{{order.customerName}}</td>
            <td colspan="2" class="align-middle text-center">
              <table class="pure-table pure-table-horizontal text-center"
              *ngIf="model.invoicesByOrder(order).count() > 0">
                <tbody>
                  <tr *ngFor="let invoice of model.invoicesByOrder(order).all(); let i = index"
                      [class.pure-table-odd]="i % 2 === 0">
                    <td>
                      <span>{{invoice.id}}</span>
                      <div class="btn-group" role="group">
                        <button type="button"
                          *ngIf="invoice.canShipped"
                          (click)="invoice.ship()"
                          class="btn btn-sm btn-success"
                          title="ship invoice">SH</button>
                        <button type="button"
                          *ngIf="invoice.canCanceled"
                          (click)="invoice.cancel()"
                          class="btn btn-sm btn-primary"
                          title="cancel invoice">CA</button>
                      </div>
                    </td>
                    <td>
                      <span>{{invoice.createdAt | date : 'yy/M/d h:mm'}}</span>
                      <div class="btn-group" role="group">
                        <button type="button"
                                *ngIf="invoice.isSaved"
                                (click)="invoice.save()"
                                class="btn btn-sm btn-success"
                                title="add to invoice">save</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
<!--                <tfoot>
                  <tr>
                    <td>&nbsp;</td>
                  </tr>
                </tfoot>-->
              </table>
            </td>
            <td colspan="7" style="padding: 0" class="align-middle text-center">
              <app-order-items-table
                [isNested]="true"
                [data]="order"></app-order-items-table>
            </td>
            <td style="padding: 0" class="align-middle text-center">
              <table class="pure-table pure-table-horizontal text-center">
                <tbody>
                  <tr *ngFor="let item of order.items; let i = index"
                      [class.pure-table-odd]="i % 2 === 0">
                    <td>
                      <span>{{item.status}}</span>
                      <div class="btn-group" role="group">
                        <button type="button"
                                *ngIf="item.canInvoiced"
                                (click)="model.toInvoiceOrderItem(item)"
                                class="btn btn-sm btn-success"
                                title="add to invoice">IN</button>
                        <button type="button"
                                *ngIf="item.canCanceled"
                                (click)="item.cancel()"
                                class="btn btn-sm btn-primary"
                                title="cancel item">CA</button>
                        <button type="button"
                                *ngIf="item.canReturned"
                                (click)="item.return()"
                                class="btn btn-sm btn-secondary"
                                title="create RMA">RM</button>
                        <button type="button"
                                *ngIf="item.canRefunded"
                                (click)="item.refund()"
                                class="btn btn-sm btn-danger"
                                title="refund">RF</button>
                      </div>
                    </td>
                  </tr>
                </tbody>
<!--                <tfoot>
                  <tr>
                    <td>&nbsp;</td>
                  </tr>
                </tfoot>-->
              </table>
            </td>
          </tr>
          <tr *ngIf="model.orders.length === 0">
            <td colspan="14"
                class="align-middle text-center">empty</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
